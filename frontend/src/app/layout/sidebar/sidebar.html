<!-- 
  The sidebar HTML has been updated to render section headers
  for better organization of the menu items.
-->
<aside 
  class="fixed left-0 top-0 h-screen bg-white border-r border-gray-200 shadow-lg z-40
         transition-all duration-300 ease-in-out flex flex-col"
  [class.w-64]="!isCollapsed || isMobile"
  [class.w-20]="isCollapsed && !isMobile"
  [class.translate-x-0]="isVisible"
  [class.-translate-x-full]="!isVisible && isMobile"
>
  <!-- Top Section (Logo and Title) -->
  <div class="flex items-center h-16 px-4 border-b border-gray-200 flex-shrink-0" [class.justify-center]="isCollapsed && !isMobile">
    <div class="flex items-center space-x-3">
      <div class="flex items-center justify-center w-8 h-8 bg-blue-600 rounded-lg text-white">
        <fa-icon [icon]="faTachometerAlt"></fa-icon>
      </div>
      <h2 class="text-xl font-bold text-gray-800 transition-opacity duration-300" [class.opacity-0]="isCollapsed" [class.hidden]="isCollapsed">
        AdminPro
      </h2>
    </div>
  </div>

  <!-- Middle Section (Navigation) -->
  <nav class="flex-1 px-3 py-4 overflow-y-auto">
    <ul class="space-y-1">
      <li *ngFor="let item of menuItems">
        <!-- Section Header -->
        <div *ngIf="item.section" class="px-3 py-2 text-xs font-semibold text-gray-400 uppercase tracking-wider" [class.hidden]="isCollapsed && !isMobile">
          {{ item.section }}
        </div>

        <!-- Menu Item -->
        <div *ngIf="!item.section">
          <button (click)="item.children ? toggleSubmenu(item) : navigateTo(item.route)" class="flex items-center w-full px-3 py-2.5 text-left rounded-lg transition-all duration-200 group relative" [class.justify-center]="isCollapsed && !isMobile" [class]="item.isActive ? 'bg-blue-50 text-blue-700' : 'text-gray-700 hover:bg-gray-100 hover:text-gray-900'">
            <fa-icon [icon]="item.icon" class="flex-shrink-0 w-5 h-5 transition-colors duration-200" [class.text-blue-600]="item.isActive" [class.text-gray-500]="!item.isActive"></fa-icon>
            <span class="ml-3 font-medium transition-all duration-200" [class.opacity-0]="isCollapsed" [class.hidden]="isCollapsed">{{ item.label }}</span>
            <fa-icon *ngIf="item.children && !isCollapsed" [icon]="faChevronDown" class="ml-auto text-xs transition-transform duration-200" [class.rotate-180]="item.isExpanded"></fa-icon>
            <div *ngIf="isCollapsed && !isMobile" class="absolute left-full ml-4 px-2 py-1 bg-gray-800 text-white text-sm rounded-md opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 whitespace-nowrap z-50">
              {{ item.label }}
              <div class="absolute left-0 top-1/2 w-2 h-2 bg-gray-800 transform -translate-x-1/2 -translate-y-1/2 rotate-45"></div>
            </div>
          </button>
          <div *ngIf="item.children && item.isExpanded && !isCollapsed" class="mt-1 ml-4 pl-5 border-l-2 border-gray-200 space-y-1 transition-all duration-300 ease-in-out">
            <button *ngFor="let child of item.children" (click)="navigateTo(child.route)" class="flex items-center w-full px-3 py-2 text-sm rounded-lg transition-all duration-200" [class]="child.isActive ? 'text-blue-700 font-semibold' : 'text-gray-600 hover:bg-gray-100 hover:text-gray-900'">
              <fa-icon [icon]="child.icon" class="mr-3 w-4 h-4"></fa-icon>
              {{ child.label }}
            </button>
          </div>
        </div>
      </li>
    </ul>
  </nav>

  <!-- Bottom Section (User Profile & Toggle) -->
  <div class="flex-shrink-0">
    <div class="p-3 border-t border-gray-200">
      <div class="flex items-center" [class.justify-center]="isCollapsed && !isMobile">
        <img src="https://placehold.co/32x32/6366f1/white?text=JD" alt="User Avatar" class="w-8 h-8 rounded-full">
        <div class="flex-1 ml-3 transition-all duration-300" [class.opacity-0]="isCollapsed" [class.hidden]="isCollapsed">
          <p class="text-sm font-medium text-gray-900">Jane Doe</p>
          <p class="text-xs text-gray-500">Victim</p>
        </div>
        <button (click)="logout()" class="p-1 rounded hover:bg-gray-100 transition-colors duration-200" [class.hidden]="isCollapsed" title="Logout">
          <fa-icon [icon]="faSignOutAlt" class="text-gray-600"></fa-icon>
        </button>
      </div>
    </div>
    <div *ngIf="!isMobile" class="p-3 border-t border-gray-200">
      <button (click)="onToggle()" class="w-full flex items-center p-2.5 rounded-lg hover:bg-gray-100 transition-colors" [class.justify-center]="isCollapsed">
        <fa-icon [icon]="isCollapsed ? faChevronRight : faChevronLeft" class="text-gray-600 w-5 h-5"></fa-icon>
        <span class="ml-3 font-medium transition-all duration-200 text-gray-700" [class.opacity-0]="isCollapsed" [class.hidden]="isCollapsed">
            Collapse
        </span>
      </button>
    </div>
  </div>
</aside>
